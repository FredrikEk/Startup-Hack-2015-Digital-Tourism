var GSVPANO=GSVPANO||{};
GSVPANO.PanoLoader=function(k){var k=k||{},d,o=new google.maps.StreetViewService,j=0,l=0,h=document.createElement("canvas"),m=h.getContext("2d"),g=this;this.onProgress=function(){};this.onError=function(){console.error(message)};this.onPanoramaLoad=function(){};this.onPanoramaData=function(){};this.onNoPanoramaData=function(){};this.adaptTextureToZoom=function(){var a=416*Math.pow(2,d),e=416*Math.pow(2,d-1);h.width=a;h.height=e;m.translate(h.width,0);m.scale(-1,1)};this.composePanorama=function(a,
e){e=e||function(){};this.onProgress(0);console.log("Loading panorama for zoom "+d+"...");var n=Math.pow(2,d),c=Math.pow(2,d-1),f,b,i;j=0;l=n*c;for(i=0;i<c;i++)for(b=0;b<n;b++)f="http://maps.google.com/cbk?output=tile&panoid="+a+"&zoom="+d+"&x="+b+"&y="+i+"&"+Date.now(),console.log(f),function(c,a){var b=new Image;b.addEventListener("load",function(){m.drawImage(this,512*c,512*a);j++;var b=Math.round(100*j/l);g.onProgress(b);j===l&&(g.canvas=h,g.onPanoramaLoad(),e(null,h))});b.crossOrigin="";b.src=
f}(b,i)};this.load=function(a,e){e=e||function(){};console.log("Load for",a);g.find(a,function(a,c){a||g.composePanorama(c.id,function(a,b){c.canvas=b;e.call(c,a,b,c)})})};this.find=function(a,e){var d=null,c={};o.getPanoramaByLocation(a,50,function(f,b){b===google.maps.StreetViewStatus.OK?(g.onPanoramaData(f),google.maps.geometry.spherical.computeHeading(a,f.location.latLng),c.copyright=f.copyright,c.pitch=f.tiles.originPitch,c.heading=f.tiles.centerHeading,c.location=a,c.imageDate=f.imageDate,c.id=
f.location.pano):(g.onNoPanoramaData(b),d=Error("Could not retrieve panorama for the following reason: "+b),g.onError(d.message));e(d,c)})};this.setZoom=function(a){d=a;this.adaptTextureToZoom()};this.setZoom(k.zoom||1)};
